/// <reference types="cypress" />

//Body positivo - 200 OK - GET
import send_campoNome_200_Positive          from '../../../../../fixtures/api/cadastro/send/GET/positive/send_campoNome_200_positive.json';
import send_campoNome_200_Positive_2        from '../../../../../fixtures/api/cadastro/send/GET/positive/send_campoNome_200_positive_2.json';
import send_campoNome_200_Positive_3        from '../../../../../fixtures/api/cadastro/send/GET/positive/send_campoNome_200_positive_3.json';

import return_campoNome_201_positive        from '../../../../../fixtures/api/cadastro/return/GET/positive/return_campoNome_200_Sucefull.json';
import return_campoNome_201_positive_2      from '../../../../../fixtures/api/cadastro/return/GET/positive/return_campoNome_200_Sucefull_2.json';
import return_campoNome_201_positive_3      from '../../../../../fixtures/api/cadastro/return/GET/positive/return_campoNome_200_Sucefull_3.json';

//Body positivo - 201 Created - POST
import send_campoNome_201_Positive          from '../../../../../fixtures/api/cadastro/send/POST/positive/send_campoNome_201_positive.json';
import send_campoNome_201_Positive_2        from '../../../../../fixtures/api/cadastro/send/POST/positive/send_campoNome_201_positive_2.json';
import send_campoNome_201_Positive_3        from '../../../../../fixtures/api/cadastro/send/POST/positive/send_campoNome_201_positive_3.json';

import return_campoNome_201_positive        from '../../../../../fixtures/api/cadastro/return/POST/positive/return_campoNome_201_Sucefull.json';
import return_campoNome_201_positive_2      from '../../../../../fixtures/api/cadastro/return/POST/positive/return_campoNome_201_Sucefull_2.json';
import return_campoNome_201_positive_3      from '../../../../../fixtures/api/cadastro/return/POST/positive/return_campoNome_201_Sucefull_3.json';

//Body positivo - 204 - DELETE
import send_campoNome_204_Positive          from '../../../../../fixtures/api/cadastro/send/DELETE/positive/send_campoNome_204_positive.json';
import send_campoNome_204_Positive_2        from '../../../../../fixtures/api/cadastro/send/DELETE/positive/send_campoNome_204_positive_2.json';
import send_campoNome_204_Positive_3        from '../../../../../fixtures/api/cadastro/send/DELETE/positive/send_campoNome_204_positive_3.json';

import return_campoNome_204_positive        from '../../../../../fixtures/api/cadastro/return/DELETE/positive/return_campoNome_204_Sucefull.json';
import return_campoNome_204_positive_2      from '../../../../../fixtures/api/cadastro/return/DELETE/positive/return_campoNome_204_Sucefull_2.json';
import return_campoNome_204_positive_3      from '../../../../../fixtures/api/cadastro/return/DELETE/positive/return_campoNome_204_Sucefull_3.json';

//Body positivo - 204 - PUT
import send_campoNome_204_Positive          from '../../../../../fixtures/api/cadastro/send/PUT/positive/send_campoNome_204_positive.json';
import send_campoNome_204_Positive_2        from '../../../../../fixtures/api/cadastro/send/PUT/positive/send_campoNome_204_positive_2.json';
import send_campoNome_204_Positive_3        from '../../../../../fixtures/api/cadastro/send/PUT/positive/send_campoNome_204_positive_3.json';

import return_campoNome_204_positive        from '../../../../../fixtures/api/cadastro/return/PUT/positive/return_campoNome_204_Sucefull.json';
import return_campoNome_204_positive_2      from '../../../../../fixtures/api/cadastro/return/PUT/positive/return_campoNome_204_Sucefull_2.json';
import return_campoNome_204_positive_3      from '../../../../../fixtures/api/cadastro/return/PUT/positive/return_campoNome_204_Sucefull_3.json';


import del_Docs     from '../../../../../fixtures/api/send/delete/positive/del_Docs_customer_201_positive.json';

import headerMe01   from '../../../../../fixtures/api/header/headerMe01.json';

//Body negativo - 400 Bad request - GET
import send_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/send/GET/negative/send_campoNome_400_Negative.json';                        
import send_campoNome_400_Negative_2    from '../../../../../fixtures/api/cadastro/send/GET/negative/send_campoNome_400_Negative_2.json';                         
import send_campoNome_400_Negative_3    from '../../../../../fixtures/api/cadastro/send/GET/negative/send_campoNome_400_Negative_3.json';              

import return_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/return/GET/negative/return_campoNome_400_Negative.json';                        
import return_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/return/GET/negative/return_campoNome_400_Negative.json';                        
import return_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/return/GET/negative/return_campoNome_400_Negative.json'; 

//Body negativo - 400 Bad request - POST
import send_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/send/POST/negative/send_campoNome_400_Negative.json';                        
import send_campoNome_400_Negative_2    from '../../../../../fixtures/api/cadastro/send/POST/negative/send_campoNome_400_Negative_2.json';                         
import send_campoNome_400_Negative_3    from '../../../../../fixtures/api/cadastro/send/POST/negative/send_campoNome_400_Negative_3.json';              

import return_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/return/POST/negative/return_campoNome_400_Negative.json';                        
import return_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/return/POST/negative/return_campoNome_400_Negative.json';                        
import return_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/return/POST/negative/return_campoNome_400_Negative.json';                        

//Body negativo - 400 Bad request - DELETE
import send_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/send/DELETE/negative/send_campoNome_400_Negative.json';                        
import send_campoNome_400_Negative_2    from '../../../../../fixtures/api/cadastro/send/DELETE/negative/send_campoNome_400_Negative_2.json';                         
import send_campoNome_400_Negative_3    from '../../../../../fixtures/api/cadastro/send/DELETE/negative/send_campoNome_400_Negative_3.json';              

import return_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/return/DELETE/negative/return_campoNome_400_Negative.json';                        
import return_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/return/DELETE/negative/return_campoNome_400_Negative.json';                        
import return_campoNome_400_Negative      from '../../../../../fixtures/api/cadastro/return/DELETE/negative/return_campoNome_400_Negative.json'; 

//Body negativo - 500 - POST
import send_campoNome_500_Negative      from '../../../../../fixtures/api/cadastro/send/POST/negative/send_campoNome_500_Negative.json';                        
import send_campoNome_500_Negative_2    from '../../../../../fixtures/api/cadastro/send/POST/negative/send_campoNome_500_Negative_2.json';                         
import send_campoNome_500_Negative_3    from '../../../../../fixtures/api/cadastro/send/POST/negative/send_campoNome_500_Negative_3.json';              

import return_campoNome_500_Negative      from '../../../../../fixtures/api/cadastro/return/POST/negative/return_campoNome_500_Negative.json';                        
import return_campoNome_500_Negative      from '../../../../../fixtures/api/cadastro/return/POST/negative/return_campoNome_500_Negative.json';                        
import return_campoNome_500_Negative      from '../../../../../fixtures/api/cadastro/return/POST/negative/return_campoNome_500_Negative.json';   

import {GET, POST, PUT, DELETE} from '../../../../../fixtures/api/common/methodRest.js';
import { describe } from 'mocha';
import CryptoJS from 'crypto-js';

let token;
let bodyAPI = {};

const urlPostCadastroApi = 'https://urlCadastroApi-dev.br'

const url = "https://urlCadastroApi-dev.br"
const urlGet = "https://urlCadastroApiget-dev.br"

const urlInvalid = 'https://urlCadastroApi-dev.b'
const urlDel = "https://urlCadastroApi-dev.br/exclude"

const urlIntegracao = "https://urlCadastroApi-dev/integracao"

//GET token
before(() => {
    cy.token('stg');
    cy.fixture('token-stg').then(arr => token = arr);
});

describe('send subscription - Scenario positive - StatusCode 201 - Successful operation', () => {
    ;[        
        { scenario: `[POST] Send inclusion document registered sucefull`,           sendingdata: send_DocCadastradoNoProRede,   retEsperado: return_DocCadastradoNoProRede}, 
        { scenario: `[POST] Send inclusion three document registered sucefull`,     sendingdata: send_3DocCadastradoNoProRede,  retEsperado: return_3DocCadastradoNoProRede}, 

    ].forEach(data => {
        it(`scenario - ${data.scenario}`, function() {
            bodyAPI = data.sendingdata;
            const logbodyAPI = JSON.stringify(bodyAPI, undefined, 2);
            cy.log(`bodyAPI = ${logbodyAPI}`);
            
            cy.req(POST, url, token, bodyAPI).then((respReq) => {
                expect(respReq.statusCod).to.deep.equal(201);
                expect(data.retEsperado).to.deep.equal(respReq.retBody) 
            });
        });
    });
});

describe('send subscription - Scenario negative / Validation field - StatusCode 400 - Bad Request', () => { 
    ;[
        { scenario: '[POST] Send inclusion document nonexistent',       sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send inclusion document no registred',      sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send inclusion three document no registred',sendingdata: send_campoNome_400_Negative},
        { scenario: `[POST] Send Body with more 1000 subscription`,     sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "Nome" (Null)',                  sendingdata: send_campoNome_400_Negative}, 
        { scenario: '[POST] Send field "Nome" (Empty)',                 sendingdata: send_campoNome_400_Negative},      
        { scenario: '[POST] Send field "Nome" (whitespace)',            sendingdata: send_campoNome_400_Negative}, 
        { scenario: '[POST] Send without field "Nome"',                 sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "Nome" (True)',                  sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "Nome" (False)',                 sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "Nome" (Int number)',            sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "Nome" (Real number)',           sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "Email" (True)',                 sendingdata: send_campoNome_400_Negative}, 
        { scenario: '[POST] Send field "Email" (False)',                sendingdata: send_campoNome_400_Negative},      
        { scenario: '[POST] Send field "Email" (Invalid Enuns)',        sendingdata: send_campoNome_400_Negative}, 
        { scenario: '[POST] Send field "Email" (Int number)',           sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "Email" (Real number)',          sendingdata: send_campoNome_400_Negative},    
        { scenario: '[POST] Send field "Email" (whitespace)',           sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "Email" (Null)',                 sendingdata: send_campoNome_400_Negative},  
        { scenario: '[POST] Send without field "Email"',                sendingdata: send_campoNome_400_Negative}, 
        { scenario: '[POST] Send field "Email" (Field empty)',          sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "Email" (Special characteres)',  sendingdata: send_campoNome_400_Negative}, 
        { scenario: '[POST] Send field "Email" (Field with lyrics)',    sendingdata: send_campoNome_400_Negative}, 
        { scenario: '[POST] Send field "CPF" (Int number)',             sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "CPF" (Real number)',            sendingdata: send_campoNome_400_Negative},    
        { scenario: '[POST] Send field "CPF" (whitespace)',             sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "CPF" (Null)',                   sendingdata: send_campoNome_400_Negative},  
        { scenario: '[POST] Send without field "CPF"',                  sendingdata: send_campoNome_400_Negative}, 
        { scenario: '[POST] Send field "CPF" (Field empty)',            sendingdata: send_campoNome_400_Negative},
        { scenario: '[POST] Send field "CPF" (Special characteres)',    sendingdata: send_campoNome_400_Negative}, 
        { scenario: '[POST] Send field "CPF" (Field with lyrics)',      sendingdata: send_campoNome_400_Negative}, 

    ].forEach(data => {

        it(`scenario - ${data.scenario}`, function() {

            bodyAPI = data.sendingdata;
            const logbodyAPI = JSON.stringify(bodyAPI, undefined, 2);
            cy.log(`bodyAPI = ${logbodyAPI}`);

            cy.req(POST, url, token, bodyAPI).then((respReq) => {
                expect(respReq.statusCod).to.deep.equal(400);
            })
        })   
    })  
});

describe('send subscription - Scenarios negatives - StatusCode 401 Unauthorized', () => { 
    ;[        
        { scenario: '[POST] Send request with token inválid',   useAuthentication: false,   url: url,           sendingdata: send_campoNome_401_Negative},
        { scenario: '[POST] Send request with url inválid',     useAuthentication: true,    url: urlInvalid,    sendingdata: send_campoNome_401_Negative},
       
    ].forEach(data => {

        it(`scenario - ${data.scenario}`, function() {
            const requestToken = data.useAuthentication ? token : undefined;
            bodyAPI = data.sendingdata;
            const logbodyAPI = JSON.stringify(bodyAPI, undefined, 2);
            cy.log(`bodyAPI = ${logbodyAPI}`);

            cy.req(POST, data.url, requestToken).then((respReq) => {      
                expect(respReq.statusCod).to.deep.equal(401);
            })
        })   
    })  
});

describe('send subscription - Scenarios negatives - StatusCode 404 - Not Found', () => { 
    ;[        
        { scenario: '[POST] Send request with url inválid',     useAuthentication: true,    url: urlInvalid,    sendingdata: send_campoNome_201_Positive},
       
    ].forEach(data => {

        it(`scenario - ${data.scenario}`, function() {
            const requestToken = data.useAuthentication ? token : undefined;
            bodyAPI = data.sendingdata;
            const logbodyAPI = JSON.stringify(bodyAPI, undefined, 2);
            cy.log(`bodyAPI = ${logbodyAPI}`);

            cy.req(POST, urlInvalid, token).then((respReq) => {      
                expect(respReq.statusCod).to.deep.equal(404);
            })
        })   
    })  
});

describe('send subscription - Scenario negative / Validation field - StatusCode 500 - Internal Server Error', () => { 
    ;[
        { scenario: '[POST] Send inclusion document with all invalid',                  sendingdata: send_campoNome_500_Negative,},
        { scenario: '[POST] Send inclusion document field "Document number" null',      sendingdata: send_campoNome_500_Negative,},
        { scenario: '[POST] Send inclusion document without field "Document Number"',   sendingdata: send_campoNome_500_Negative, },

    ].forEach(data => {

        it(`scenario - ${data.scenario}`, function() {

            bodyAPI = data.sendingdata;
            const logbodyAPI = JSON.stringify(bodyAPI, undefined, 2);
            cy.log(`bodyAPI = ${logbodyAPI}`);

            cy.req(POST, url, token, bodyAPI).then((respReq) => {
                expect(respReq.statusCod).to.deep.equal(500);
            })
        })   
    })  
});

describe('GET a list subscription - Scenario positive - StatusCode 200 OK', () => {

    ;[        
        { scenario: '[GET] Validate StatusCode 200 - Successful operation'},
        
    ].forEach(data => {

        it(`Scenario - ${data.scenario}`, function() {

            cy.req(GET, urlGet, token, bodyAPI).then((respReq) => {      
                expect(respReq.statusCod).to.deep.equal(200);
            });
        });
    });
});

describe('GET Subscription - Scenarios negatives - StatusCode 401 Unauthorized / 400 Not Found', () => { 
    ;[        
        { scenario: '[GET] Send request with token inválid',       useAuthentication: false,   url: url,                   sendingdata: send_campoNome_400_Negative,     expectedStatusCode: 401     },
        { scenario: '[GET] Send request with url inválid',         useAuthentication: true,    url: urlInvalid,            sendingdata: send_campoNome_400_Negative,     expectedStatusCode: 401     },
       
    ].forEach(data => {

        it(`scenario - ${data.scenario}`, function() {
            const requestToken = data.useAuthentication ? token : undefined;
            bodyAPI = data.sendingdata;
            const logbodyAPI = JSON.stringify(bodyAPI, undefined, 2);
            cy.log(`bodyAPI = ${logbodyAPI}`);

            cy.req(GET, data.url, requestToken).then((respReq) => {      
                expect(respReq.statusCod).to.deep.equal(401);
              

            })
        })   
    })  
});

describe('Deleting subscription - Scenarios negatives - StatusCode 400 - Bad Request', () => {
    ;[

        { scenario: '[DELETE] Send request with document nonexistent',  sendingdata: send_campoNome_400_Negative},               
        { scenario: '[DELETE] Send request with (special characteres)', sendingdata: send_campoNome_400_Negative},    
        { scenario: '[DELETE] Send request with field (empty)',         sendingdata: send_campoNome_400_Negative},
        { scenario: '[DELETE] Send request with field (True)',          sendingdata: send_campoNome_400_Negative},
        { scenario: '[DELETE] Send request with field (False)',         sendingdata: send_campoNome_400_Negative},
        { scenario: '[DELETE] Send request with (Body empty)',          sendingdata: send_campoNome_400_Negative},


    ].forEach(data => {

        it(`scenario - ${data.scenario}`, function() {

            bodyAPI = data.sendingdata;
            const logbodyAPI = JSON.stringify(bodyAPI, undefined, 2);
            cy.log(`bodyAPI = ${logbodyAPI}`);
     
            cy.req(POST, urlDel, token, bodyAPI).then((respReq) => {
                expect(respReq.statusCod).to.deep.equal(400);        
                });
            });
    })  
});

describe('Deleting subscription - Scenarios negatives - StatusCode 500', () => {
    ;[

        { scenario: '[DELETE] Send request with field (Null)',  sendingdata: send_campoNome_400_Negative},


    ].forEach(data => {

        it(`scenario - ${data.scenario}`, function() {

            bodyAPI = data.sendingdata;
            const logbodyAPI = JSON.stringify(bodyAPI, undefined, 2);
            cy.log(`bodyAPI = ${logbodyAPI}`);
     
            cy.req(POST, urlDel, token, bodyAPI).then((respReq) => {
                expect(respReq.statusCod).to.deep.equal(500);        
                });
            });
    })  
});

describe('send subscription to DEL - scenario positive - StatusCode 201 - Successful operation', () => {
    ;[        
        { scenario: `[POST] Creating a new document to test of exclusion`,  sendingdata: send_campoNome_201_Negative}, 

    ].forEach(data => {

        it(`scenario - ${data.scenario}`, function() {

            bodyAPI = data.sendingdata;
            const logbodyAPI = JSON.stringify(bodyAPI, undefined, 2);
            cy.log(`bodyAPI = ${logbodyAPI}`);
     
            cy.req(POST, url, tokenMenuProdutos, bodyAPI).then((respReq) => {
                expect(respReq.statusCod).to.deep.equal(201);        
                });
            });
        }); 
});

describe('Deleting subscription - Scenario positive', () => { 
    ;[
       
      { scenario: '[DELETE] Send a request with document no registred and registred to exclusion',  sendingdata: send_campoNome_400_Negative},
      { scenario: '[DELETE] Send a request with all document registred to exclusion',               sendingdata: send_campoNome_400_Negative},
      { scenario: '[DELETE] Send a request with one document registred to exclusion',               sendingdata: send_campoNome_400_Negative},

    ].forEach(data => {
        it(`scenario - ${data.scenario}`, function() {

            bodyAPI = data.sendingdata;
            const logbodyAPI = JSON.stringify(bodyAPI, undefined, 2);
            cy.log(`bodyAPI = ${logbodyAPI}`);
     
            cy.req(POST, urlDel, token, bodyAPI).then((respReq) => {
                expect(respReq.statusCod).to.deep.equal(200);        
                });
            });
    })  
});

describe('Clean subscriptions to test', () => {
    ;[        
        { scenario: `Deleting Owner`},  

    ].forEach(data => {

        it(`scenario - ${data.scenario}`, function() {

            bodyAPI = data.sendingdata;
            const logbodyAPI = JSON.stringify(bodyAPI, undefined, 2);
            cy.log(`bodyAPI = ${logbodyAPI}`);
     
            cy.req(DELETE, urlDataWithQuery, token).then((respReq) => {
                expect(respReq.statusCod).to.deep.equal(204);        
                });
            });
        }); 
});


